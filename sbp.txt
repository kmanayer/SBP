(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")
(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (answer cookie tlskey data))
    (trace (recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey))))
  (defrole proxy
    (vars (answer cookie tlskey data))
    (trace (send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    (uniq-gen answer cookie)))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (pen-non-orig tlskey)
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer)))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation encryption-test (added-strand proxy 3)
    (enc "response" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey))))
  (label 1)
  (parent 0)
  (unrealized (1 0) (2 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (deflistener tlskey)
  (precedes ((2 1) (0 2)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-listener tlskey)
    (enc "response" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer)) ((recv tlskey) (send tlskey)))
  (label 2)
  (parent 0)
  (unrealized (2 0))
  (dead)
  (comment "empty cohort"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((0 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation encryption-test (displaced 3 0 client 2)
    (enc "request" cookie tlskey) (2 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey))))
  (label 3)
  (parent 1)
  (unrealized (1 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand client 2 (cookie cookie) (tlskey tlskey))
  (precedes ((2 0) (0 0)) ((2 0) (3 0)) ((2 2) (0 2)) ((2 2) (1 0))
    ((3 1) (2 1)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation encryption-test (added-strand client 2)
    (enc "request" cookie tlskey) (2 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    ((recv cookie) (send (enc "request" cookie tlskey))))
  (label 4)
  (parent 1)
  (unrealized (1 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)) ((3 1) (2 1)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation encryption-test (added-listener tlskey)
    (enc "request" cookie tlskey) (2 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 5)
  (parent 1)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((0 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0))
    ((3 1) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation nonce-test (added-listener tlskey) answer (1 0)
    (enc "response" answer cookie tlskey))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 6)
  (parent 3)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand client 2 (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((2 0) (0 0)) ((2 0) (3 0)) ((2 2) (0 2)) ((2 2) (1 0))
    ((3 1) (2 1)) ((4 1) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer cookie)
  (operation nonce-test (added-listener tlskey) answer (1 0)
    (enc "response" answer cookie tlskey))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    ((recv cookie) (send (enc "request" cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 7)
  (parent 4)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((2 0) (0 0)) ((2 0) (3 0)) ((2 2) (0 2)) ((2 2) (1 0))
    ((3 1) (2 1)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation nonce-test (displaced 4 2 proxy 1) tlskey (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 8)
  (parent 5)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((0 1) (2 1)) ((2 0) (0 0)) ((2 0) (3 0)) ((2 2) (0 2))
    ((2 2) (1 0)) ((3 1) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation nonce-test (displaced 4 2 proxy 1) tlskey (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 9)
  (parent 6)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand client 2 (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((2 0) (0 0)) ((2 0) (3 0)) ((2 0) (4 0)) ((2 2) (0 2))
    ((2 2) (1 0)) ((3 1) (2 1)) ((4 1) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation nonce-test (displaced 5 2 proxy 1) tlskey (4 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie)))
    ((recv cookie) (send (enc "request" cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 10)
  (parent 7)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (precedes ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation generalization deleted (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie))))
  (label 11)
  (parent 8)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (precedes ((0 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation generalization deleted (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie))))
  (label 12)
  (parent 9)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((2 0) (0 0)) ((2 0) (3 0)) ((2 2) (0 2)) ((2 2) (1 0))
    ((3 1) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation generalization deleted (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 13)
  (parent 10)
  (seen 11)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 data))
  (defstrand client 3 (answer answer) (cookie cookie-0)
    (tlskey cookie-0))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie-0) (tlskey cookie))
  (precedes ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig cookie-0)
  (uniq-gen answer cookie-0)
  (operation generalization separated cookie-0)
  (traces
    ((recv cookie-0) (send (enc "request" cookie-0 cookie-0))
      (recv (enc "response" answer cookie-0 cookie-0)))
    ((recv answer) (send answer))
    ((send cookie-0) (recv (enc "request" cookie-0 cookie))
      (send (enc "response" answer cookie-0 cookie))))
  (label 14)
  (parent 11)
  (unrealized)
  (shape)
  (maps ((0 1) ((answer answer) (tlskey cookie-0) (cookie cookie-0))))
  (origs))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (precedes ((0 1) (1 0)) ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig cookie)
  (uniq-gen answer cookie)
  (operation generalization weakened ((0 1) (2 1)))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response" answer cookie cookie)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response" answer cookie cookie))))
  (label 15)
  (parent 12)
  (seen 11)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(comment "Nothing left to do")
