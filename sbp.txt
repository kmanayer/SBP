(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")
(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (answer cookie tlskey data))
    (trace (recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey))))
  (defrole proxy
    (vars (answer cookie tlskey data))
    (trace (send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    (uniq-gen answer cookie)))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (pen-non-orig tlskey)
  (uniq-gen tlskey)
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey))))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (uniq-gen answer tlskey cookie)
  (operation encryption-test (added-strand proxy 3)
    (enc "response" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey))))
  (label 1)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0) ((answer answer) (tlskey tlskey) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((0 1) (1 0)) ((1 1) (0 2)))
  (pen-non-orig tlskey)
  (uniq-gen tlskey)
  (operation encryption-test (added-listener tlskey)
    (enc "response" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 2)
  (parent 0)
  (unrealized (1 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")
