(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")
(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (answer cookie tlskey data))
    (trace (recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))))
  (defrole proxy
    (vars (answer cookie tlskey data))
    (trace (send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (pen-non-orig tlskey)
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-strand proxy 3)
    (enc "response2" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey))))
  (label 1)
  (parent 0)
  (unrealized (1 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((1 1) (0 2)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-listener tlskey)
    (enc "response2" answer cookie tlskey) (0 2))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 2)
  (parent 0)
  (unrealized (1 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (operation encryption-test (displaced 2 0 client 2)
    (enc "request" cookie tlskey) (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey))))
  (label 3)
  (parent 1)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand client 2 (cookie cookie) (tlskey tlskey))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-strand client 2)
    (enc "request" cookie tlskey) (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))
    ((recv cookie) (send (enc "request" cookie tlskey))))
  (label 4)
  (parent 1)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-listener tlskey)
    (enc "request" cookie tlskey) (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)))
  (label 5)
  (parent 1)
  (unrealized (2 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie cookie-0 tlskey-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (defstrand proxy 3 (answer tlskey) (cookie cookie-0)
    (tlskey tlskey-0))
  (precedes ((1 1) (0 2)) ((2 2) (1 0)))
  (pen-non-orig tlskey)
  (operation nonce-test (added-strand proxy 3) tlskey (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey-0))
      (send (enc "response2" tlskey cookie-0 tlskey-0))))
  (label 6)
  (parent 2)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((1 1) (0 2)) ((2 0) (1 0)))
  (pen-non-orig tlskey)
  (operation nonce-test (added-strand proxy 1) tlskey (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)) ((send tlskey)))
  (label 7)
  (parent 2)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie cookie-0 tlskey-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (defstrand proxy 3 (answer tlskey) (cookie cookie-0)
    (tlskey tlskey-0))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)) ((3 2) (2 0)))
  (pen-non-orig tlskey)
  (operation nonce-test (added-strand proxy 3) tlskey (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey-0))
      (send (enc "response2" tlskey cookie-0 tlskey-0))))
  (label 8)
  (parent 5)
  (seen 6)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((1 0) (2 0)) ((1 2) (0 2)) ((2 1) (1 1)))
  (pen-non-orig cookie)
  (operation nonce-test (displaced 3 1 proxy 1) tlskey (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie)))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response2" answer cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 9)
  (parent 5)
  (unrealized (0 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener tlskey)
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (2 0)))
  (pen-non-orig tlskey)
  (operation nonce-test (added-strand proxy 1) tlskey (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))
    ((recv tlskey) (send tlskey)) ((send tlskey)))
  (label 10)
  (parent 5)
  (seen 7)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie cookie-0 tlskey-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer tlskey) (cookie cookie-0)
    (tlskey tlskey-0))
  (precedes ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (operation generalization deleted (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey-0))
      (send (enc "response2" tlskey cookie-0 tlskey-0))))
  (label 11)
  (parent 6)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((1 0) (0 2)))
  (pen-non-orig tlskey)
  (operation generalization deleted (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))) ((send tlskey)))
  (label 12)
  (parent 7)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (defstrand proxy 3 (answer cookie) (cookie cookie-0) (tlskey tlskey))
  (precedes ((1 0) (2 0)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 2) (0 0)))
  (pen-non-orig cookie)
  (operation nonce-test (added-strand proxy 3) cookie (0 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie)))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response2" answer cookie cookie)))
    ((recv cookie) (send cookie))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie cookie-0 tlskey))))
  (label 13)
  (parent 9)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (precedes ((1 0) (0 0)) ((1 0) (2 0)) ((1 2) (0 2)) ((2 1) (1 1)))
  (pen-non-orig cookie)
  (operation nonce-test (displaced 3 1 proxy 1) cookie (0 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie)))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response2" answer cookie cookie)))
    ((recv cookie) (send cookie)))
  (label 14)
  (parent 9)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey cookie))
  (deflistener cookie)
  (defstrand proxy 1 (cookie cookie))
  (precedes ((1 0) (2 0)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0)))
  (pen-non-orig cookie)
  (operation nonce-test (added-strand proxy 1) cookie (0 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie)))
    ((send cookie) (recv (enc "request" cookie cookie))
      (send (enc "response2" answer cookie cookie)))
    ((recv cookie) (send cookie)) ((send cookie)))
  (label 15)
  (parent 9)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (deflistener cookie)
  (defstrand proxy 3 (answer cookie) (cookie cookie-0) (tlskey tlskey))
  (precedes ((1 0) (2 0)) ((2 1) (0 2)) ((3 2) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie))
    ((recv cookie) (send cookie))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie cookie-0 tlskey))))
  (label 16)
  (parent 13)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (deflistener cookie)
  (precedes ((1 0) (0 0)) ((1 0) (2 0)) ((2 1) (0 2)))
  (pen-non-orig cookie)
  (operation generalization deleted (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie))
    ((recv cookie) (send cookie)))
  (label 17)
  (parent 14)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (deflistener cookie)
  (defstrand proxy 1 (cookie cookie))
  (precedes ((1 0) (2 0)) ((2 1) (0 2)) ((3 0) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie))
    ((recv cookie) (send cookie)) ((send cookie)))
  (label 18)
  (parent 15)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (defstrand proxy 3 (answer cookie) (cookie cookie-0) (tlskey tlskey))
  (precedes ((1 0) (0 2)) ((2 2) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie cookie-0 tlskey))))
  (label 19)
  (parent 16)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (precedes ((1 0) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie)))
  (label 20)
  (parent 17)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 1 (cookie cookie))
  (defstrand proxy 1 (cookie cookie))
  (precedes ((1 0) (0 2)) ((2 0) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie))) ((send cookie))
    ((send cookie)))
  (label 21)
  (parent 18)
  (seen 20)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie))
  (defstrand proxy 3 (answer cookie) (cookie cookie-0) (tlskey tlskey))
  (precedes ((1 2) (0 0)))
  (pen-non-orig cookie)
  (operation generalization deleted (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie))
      (recv (enc "response2" answer cookie cookie)))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie cookie-0 tlskey))))
  (label 22)
  (parent 19)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie-0))
  (defstrand proxy 1 (cookie cookie-0))
  (precedes ((1 0) (0 0)))
  (pen-non-orig cookie-0)
  (operation generalization separated cookie-0)
  (traces
    ((recv cookie) (send (enc "request" cookie cookie-0))
      (recv (enc "response2" answer cookie cookie-0)))
    ((send cookie-0)))
  (label 23)
  (parent 20)
  (seen 12)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey cookie-1 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie-1))
  (defstrand proxy 3 (answer cookie-1) (cookie cookie-0)
    (tlskey tlskey))
  (precedes ((1 2) (0 0)))
  (pen-non-orig cookie-1)
  (operation generalization separated cookie-1)
  (traces
    ((recv cookie) (send (enc "request" cookie cookie-1))
      (recv (enc "response2" answer cookie cookie-1)))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie-1 cookie-0 tlskey))))
  (label 24)
  (parent 22)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (answer cookie cookie-0 tlskey cookie-1 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie-1))
  (defstrand proxy 3 (answer cookie-1) (cookie cookie-0)
    (tlskey tlskey))
  (precedes ((1 0) (0 0)) ((1 2) (0 2)))
  (pen-non-orig cookie-1)
  (operation generalization weakened ((1 2) (0 0)))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie-1))
      (recv (enc "response2" answer cookie cookie-1)))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey))
      (send (enc "response2" cookie-1 cookie-0 tlskey))))
  (label 25)
  (parent 24)
  (seen 11)
  (unrealized)
  (comment "1 in cohort - 0 not yet seen"))

(comment "Nothing left to do")
