(comment "CPSA 3.6.6")
(comment "Extracted shapes")

(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")

(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (request2 answer answer2 cookie data) (client proxy name))
    (trace (recv (cat "response1" answer cookie client proxy))
      (send (cat "request" request2 (enc cookie (privk client))))
      (recv (enc "response2" answer2 cookie (privk proxy)))))
  (defrole proxy
    (vars (request2 answer answer2 cookie data) (client proxy name))
    (trace (send (cat "response1" answer cookie client proxy))
      (recv (cat "request" request2 (enc cookie (privk client))))
      (send (enc "response2" answer2 cookie (privk proxy)))))
  (defrole server
    (vars (request2 answer answer2 cookie data))
    (trace (init (cat answer cookie))
      (tran (cat request2 cookie) answer2))))

(defskeleton sbp
  (vars (request2 answer answer2 cookie data) (client proxy name))
  (defstrand client 3 (request2 request2) (answer answer)
    (answer2 answer2) (cookie cookie) (client client) (proxy proxy))
  (non-orig (privk client) (privk proxy))
  (traces
    ((recv (cat "response1" answer cookie client proxy))
      (send (cat "request" request2 (enc cookie (privk client))))
      (recv (enc "response2" answer2 cookie (privk proxy)))))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton sbp
  (vars (request2 answer answer2 cookie request2-0 answer-0 data)
    (client proxy client-0 name))
  (defstrand client 3 (request2 request2) (answer answer)
    (answer2 answer2) (cookie cookie) (client client) (proxy proxy))
  (defstrand proxy 3 (request2 request2-0) (answer answer-0)
    (answer2 answer2) (cookie cookie) (client client-0) (proxy proxy))
  (precedes ((1 2) (0 2)))
  (non-orig (privk client) (privk proxy))
  (operation encryption-test (added-strand proxy 3)
    (enc "response2" answer2 cookie (privk proxy)) (0 2))
  (traces
    ((recv (cat "response1" answer cookie client proxy))
      (send (cat "request" request2 (enc cookie (privk client))))
      (recv (enc "response2" answer2 cookie (privk proxy))))
    ((send (cat "response1" answer-0 cookie client-0 proxy))
      (recv (cat "request" request2-0 (enc cookie (privk client-0))))
      (send (enc "response2" answer2 cookie (privk proxy)))))
  (label 1)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((client client) (proxy proxy) (request2 request2) (answer answer)
        (answer2 answer2) (cookie cookie))))
  (origs))

(comment "Nothing left to do")
