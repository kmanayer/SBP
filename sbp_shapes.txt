(comment "CPSA 3.6.6")
(comment "Extracted shapes")

(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")

(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (challenge id secret request answer cookie syskey data)
      (proxy name))
    (trace (send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id)))))))
  (defrole proxy
    (vars (challenge id secret request answer cookie syskey data)
      (proxy name))
    (trace (recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request)
      (init request) (obsv (cat answer cookie))
      (send
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id)))))))
  (defrole server
    (vars (request answer cookie data))
    (trace (tran request (cat answer cookie)))))

(defskeleton sbp
  (vars (challenge secret id syskey request answer cookie data)
    (proxy name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id)))))))
  (label 0)
  (unrealized (0 4) (0 6))
  (origs (challenge (0 0)) (secret (0 2)))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton sbp
  (vars (id syskey request answer request-0 answer-0 cookie data)
    (proxy proxy-0 name))
  (defstrand client 7 (challenge id) (id id) (secret request)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge id) (id id) (secret request)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy-0))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (precedes ((0 0) (1 0)) ((0 5) (1 2)) ((1 6) (2 0)) ((1 8) (0 6))
    ((2 0) (1 7)))
  (leadsto ((1 6) (2 0)) ((2 0) (1 7)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig id request)
  (operation state-passing-test (displaced 3 1 proxy 7) request-1 (2 0))
  (traces
    ((send id) (recv id) (send (enc request (pubk proxy)))
      (send (enc id (hash request id id)))
      (recv (enc id (hash request id id))) (send request)
      (recv
        (cat answer (enc cookie (hash syskey (hash request id id))))))
    ((recv id) (send id) (recv (enc request (pubk proxy-0)))
      (recv (enc id (hash request id id)))
      (send (enc id (hash request id id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0 (enc cookie (hash syskey (hash request id id))))))
    ((tran request-0 (cat answer-0 cookie))))
  (label 27)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge id) (secret request) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (id (0 0)) (request (0 2))))

(defskeleton sbp
  (vars
    (id syskey request answer request-0 answer-0 cookie challenge id-0
      secret request-1 data) (proxy proxy-0 proxy-1 name))
  (defstrand client 7 (challenge id) (id id) (secret request)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge id) (id id) (secret request)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy-0))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge) (id id-0) (secret secret)
    (request request-1) (proxy proxy-1))
  (precedes ((0 0) (1 0)) ((0 5) (1 2)) ((1 8) (0 6)) ((2 0) (1 7))
    ((3 6) (2 0)))
  (leadsto ((2 0) (1 7)) ((3 6) (2 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig id request)
  (operation state-passing-test (added-strand proxy 7) request-1 (2 0))
  (traces
    ((send id) (recv id) (send (enc request (pubk proxy)))
      (send (enc id (hash request id id)))
      (recv (enc id (hash request id id))) (send request)
      (recv
        (cat answer (enc cookie (hash syskey (hash request id id))))))
    ((recv id) (send id) (recv (enc request (pubk proxy-0)))
      (recv (enc id (hash request id id)))
      (send (enc id (hash request id id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0 (enc cookie (hash syskey (hash request id id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge) (send id-0) (recv (enc secret (pubk proxy-1)))
      (recv (enc id-0 (hash secret challenge id-0)))
      (send (enc challenge (hash secret challenge id-0)))
      (recv request-1) (init request-1)))
  (label 28)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge id) (secret request) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (id (0 0)) (request (0 2))))

(defskeleton sbp
  (vars (secret id syskey request answer request-0 answer-0 cookie data)
    (proxy name))
  (defstrand client 7 (challenge id) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge id) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 3) (1 3)) ((1 6) (2 0))
    ((1 8) (0 6)) ((2 0) (1 7)))
  (leadsto ((1 6) (2 0)) ((2 0) (1 7)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig secret id)
  (operation state-passing-test (displaced 3 1 proxy 7) request-1 (2 0))
  (traces
    ((send id) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret id id)))
      (recv (enc id (hash secret id id))) (send request)
      (recv
        (cat answer (enc cookie (hash syskey (hash secret id id))))))
    ((recv id) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret id id)))
      (send (enc id (hash secret id id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0 (enc cookie (hash syskey (hash secret id id))))))
    ((tran request-0 (cat answer-0 cookie))))
  (label 38)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge id) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (id (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (secret id syskey request answer request-0 answer-0 cookie challenge
      id-0 secret-0 request-1 data) (proxy proxy-0 name))
  (defstrand client 7 (challenge id) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge id) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge) (id id-0) (secret secret-0)
    (request request-1) (proxy proxy-0))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 3) (1 3)) ((1 8) (0 6))
    ((2 0) (1 7)) ((3 6) (2 0)))
  (leadsto ((2 0) (1 7)) ((3 6) (2 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig secret id)
  (operation state-passing-test (added-strand proxy 7) request-1 (2 0))
  (traces
    ((send id) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret id id)))
      (recv (enc id (hash secret id id))) (send request)
      (recv
        (cat answer (enc cookie (hash syskey (hash secret id id))))))
    ((recv id) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret id id)))
      (send (enc id (hash secret id id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0 (enc cookie (hash syskey (hash secret id id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge) (send id-0) (recv (enc secret-0 (pubk proxy-0)))
      (recv (enc id-0 (hash secret-0 challenge id-0)))
      (send (enc challenge (hash secret-0 challenge id-0)))
      (recv request-1) (init request-1)))
  (label 39)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge id) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (id (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (challenge secret id syskey request answer request-0 answer-0 cookie
      data) (proxy name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 3) (1 3)) ((1 4) (0 4))
    ((1 6) (2 0)) ((1 8) (0 6)) ((2 0) (1 7)))
  (leadsto ((1 6) (2 0)) ((2 0) (1 7)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (operation state-passing-test (displaced 3 1 proxy 7) request-1 (2 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-0 (cat answer-0 cookie))))
  (label 43)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (challenge secret id syskey request answer request-0 answer-0 cookie
      challenge-0 id-0 secret-0 request-1 data) (proxy proxy-0 name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge-0) (id id-0) (secret secret-0)
    (request request-1) (proxy proxy-0))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 3) (1 3)) ((1 4) (0 4))
    ((1 8) (0 6)) ((2 0) (1 7)) ((3 6) (2 0)))
  (leadsto ((2 0) (1 7)) ((3 6) (2 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (operation state-passing-test (added-strand proxy 7) request-1 (2 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge-0) (send id-0) (recv (enc secret-0 (pubk proxy-0)))
      (recv (enc id-0 (hash secret-0 challenge-0 id-0)))
      (send (enc challenge-0 (hash secret-0 challenge-0 id-0)))
      (recv request-1) (init request-1)))
  (label 44)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (syskey answer request answer-0 cookie challenge id secret request-0
      data) (proxy proxy-0 name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request secret) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy-0))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer-0) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge) (id id) (secret secret)
    (request request-0) (proxy proxy-0))
  (precedes ((0 0) (1 0)) ((0 0) (3 0)) ((0 2) (3 2)) ((0 3) (3 3))
    ((0 5) (1 2)) ((1 8) (0 6)) ((2 0) (1 7)) ((3 4) (0 4))
    ((3 6) (2 0)))
  (leadsto ((2 0) (1 7)) ((3 6) (2 0)))
  (non-orig syskey (privk proxy-0))
  (pen-non-orig (pubk proxy-0))
  (uniq-orig challenge secret)
  (operation state-passing-test (displaced 1 4 proxy 7) request-0 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy-0)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send secret)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request)
      (init request) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-0 (cat answer-0 cookie)))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy-0)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0)))
  (label 51)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy-0) (request secret) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (challenge id syskey request answer request-0 answer-0 cookie data)
    (proxy proxy-0 name))
  (defstrand client 7 (challenge challenge) (id id) (secret request)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 5 (challenge challenge) (id id) (secret request)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret request)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy-0))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (precedes ((0 0) (1 0)) ((0 0) (2 0)) ((0 2) (1 2)) ((0 3) (1 3))
    ((0 5) (2 2)) ((1 4) (0 4)) ((2 6) (3 0)) ((2 8) (0 6))
    ((3 0) (2 7)))
  (leadsto ((2 6) (3 0)) ((3 0) (2 7)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge request)
  (operation state-passing-test (displaced 4 2 proxy 7) request-1 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc request (pubk proxy)))
      (send (enc id (hash request challenge id)))
      (recv (enc challenge (hash request challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash request challenge id))))))
    ((recv challenge) (send id) (recv (enc request (pubk proxy)))
      (recv (enc id (hash request challenge id)))
      (send (enc challenge (hash request challenge id))))
    ((recv challenge) (send id) (recv (enc request (pubk proxy-0)))
      (recv (enc id (hash request challenge id)))
      (send (enc challenge (hash request challenge id)))
      (recv request-0) (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash request challenge id))))))
    ((tran request-0 (cat answer-0 cookie))))
  (label 52)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret request) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (request (0 2))))

(defskeleton sbp
  (vars
    (challenge id syskey request answer request-0 answer-0 cookie
      challenge-0 id-0 secret request-1 data)
    (proxy proxy-0 proxy-1 name))
  (defstrand client 7 (challenge challenge) (id id) (secret request)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 5 (challenge challenge) (id id) (secret request)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret request)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy-0))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge-0) (id id-0) (secret secret)
    (request request-1) (proxy proxy-1))
  (precedes ((0 0) (1 0)) ((0 0) (2 0)) ((0 2) (1 2)) ((0 3) (1 3))
    ((0 5) (2 2)) ((1 4) (0 4)) ((2 8) (0 6)) ((3 0) (2 7))
    ((4 6) (3 0)))
  (leadsto ((3 0) (2 7)) ((4 6) (3 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge request)
  (operation state-passing-test (added-strand proxy 7) request-1 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc request (pubk proxy)))
      (send (enc id (hash request challenge id)))
      (recv (enc challenge (hash request challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash request challenge id))))))
    ((recv challenge) (send id) (recv (enc request (pubk proxy)))
      (recv (enc id (hash request challenge id)))
      (send (enc challenge (hash request challenge id))))
    ((recv challenge) (send id) (recv (enc request (pubk proxy-0)))
      (recv (enc id (hash request challenge id)))
      (send (enc challenge (hash request challenge id)))
      (recv request-0) (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash request challenge id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge-0) (send id-0) (recv (enc secret (pubk proxy-1)))
      (recv (enc id-0 (hash secret challenge-0 id-0)))
      (send (enc challenge-0 (hash secret challenge-0 id-0)))
      (recv request-1) (init request-1)))
  (label 53)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret request) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (request (0 2))))

(defskeleton sbp
  (vars
    (syskey request answer request-0 answer-0 cookie challenge id secret
      request-1 data) (proxy name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge) (id id) (secret secret)
    (request request-1) (proxy proxy))
  (precedes ((0 0) (1 0)) ((0 0) (3 0)) ((0 2) (1 2)) ((0 2) (3 2))
    ((0 3) (1 3)) ((0 3) (3 3)) ((1 8) (0 6)) ((2 0) (1 7))
    ((3 4) (0 4)) ((3 6) (2 0)))
  (leadsto ((2 0) (1 7)) ((3 6) (2 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (operation state-passing-test (displaced 1 4 proxy 7) request-1 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-1)
      (init request-1)))
  (label 56)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (challenge secret id syskey request answer request-0 answer-0 cookie
      data) (proxy name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 5 (challenge challenge) (id id) (secret secret)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-0) (answer answer-0)
    (cookie cookie))
  (precedes ((0 0) (1 0)) ((0 0) (2 0)) ((0 2) (1 2)) ((0 2) (2 2))
    ((0 3) (1 3)) ((0 3) (2 3)) ((1 4) (0 4)) ((2 6) (3 0))
    ((2 8) (0 6)) ((3 0) (2 7)))
  (leadsto ((2 6) (3 0)) ((3 0) (2 7)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (operation state-passing-test (displaced 4 2 proxy 7) request-1 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-0 (cat answer-0 cookie))))
  (label 57)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(defskeleton sbp
  (vars
    (challenge secret id syskey request answer request-0 answer-0 cookie
      challenge-0 id-0 secret-0 request-1 data) (proxy proxy-0 name))
  (defstrand client 7 (challenge challenge) (id id) (secret secret)
    (request request) (answer answer) (cookie cookie) (syskey syskey)
    (proxy proxy))
  (defstrand proxy 5 (challenge challenge) (id id) (secret secret)
    (proxy proxy))
  (defstrand proxy 9 (challenge challenge) (id id) (secret secret)
    (request request-0) (answer answer-0) (cookie cookie)
    (syskey syskey) (proxy proxy))
  (defstrand server 1 (request request-1) (answer answer-0)
    (cookie cookie))
  (defstrand proxy 7 (challenge challenge-0) (id id-0) (secret secret-0)
    (request request-1) (proxy proxy-0))
  (precedes ((0 0) (1 0)) ((0 0) (2 0)) ((0 2) (1 2)) ((0 2) (2 2))
    ((0 3) (1 3)) ((0 3) (2 3)) ((1 4) (0 4)) ((2 8) (0 6))
    ((3 0) (2 7)) ((4 6) (3 0)))
  (leadsto ((3 0) (2 7)) ((4 6) (3 0)))
  (non-orig syskey (privk proxy))
  (pen-non-orig (pubk proxy))
  (uniq-orig challenge secret)
  (operation state-passing-test (added-strand proxy 7) request-1 (3 0))
  (traces
    ((send challenge) (recv id) (send (enc secret (pubk proxy)))
      (send (enc id (hash secret challenge id)))
      (recv (enc challenge (hash secret challenge id))) (send request)
      (recv
        (cat answer
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))))
    ((recv challenge) (send id) (recv (enc secret (pubk proxy)))
      (recv (enc id (hash secret challenge id)))
      (send (enc challenge (hash secret challenge id))) (recv request-0)
      (init request-0) (obsv (cat answer-0 cookie))
      (send
        (cat answer-0
          (enc cookie (hash syskey (hash secret challenge id))))))
    ((tran request-1 (cat answer-0 cookie)))
    ((recv challenge-0) (send id-0) (recv (enc secret-0 (pubk proxy-0)))
      (recv (enc id-0 (hash secret-0 challenge-0 id-0)))
      (send (enc challenge-0 (hash secret-0 challenge-0 id-0)))
      (recv request-1) (init request-1)))
  (label 58)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((challenge challenge) (secret secret) (id id) (syskey syskey)
        (proxy proxy) (request request) (answer answer)
        (cookie cookie))))
  (origs (challenge (0 0)) (secret (0 2))))

(comment "Nothing left to do")
