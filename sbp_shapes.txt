(comment "CPSA 3.6.6")
(comment "Extracted shapes")

(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")

(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (answer cookie tlskey data))
    (trace (recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey))))
  (defrole proxy
    (vars (answer cookie tlskey data))
    (trace (send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    (uniq-gen answer)))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (pen-non-orig tlskey)
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer)))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((2 0) (0 2)))
  (pen-non-orig tlskey)
  (operation generalization deleted (2 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer)) ((send tlskey)))
  (label 11)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0 1) ((answer answer) (tlskey tlskey) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((0 1) (2 1)) ((2 2) (0 2)) ((2 2) (1 0)) ((3 0) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer)
  (operation generalization deleted (3 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey))) ((send tlskey)))
  (label 21)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0 1) ((answer answer) (tlskey tlskey) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (answer tlskey cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand client 2 (cookie cookie) (tlskey tlskey))
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((2 2) (0 2)) ((2 2) (1 0)) ((3 1) (2 1)) ((4 0) (1 0)))
  (pen-non-orig tlskey)
  (uniq-gen answer)
  (operation generalization deleted (4 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response" answer cookie tlskey)))
    ((recv answer) (send answer))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response" answer cookie tlskey)))
    ((recv cookie) (send (enc "request" cookie tlskey)))
    ((send tlskey)))
  (label 24)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0 1) ((answer answer) (tlskey tlskey) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (answer cookie cookie-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey cookie-0))
  (deflistener answer)
  (defstrand proxy 3 (answer answer) (cookie cookie-0) (tlskey cookie))
  (precedes ((2 2) (0 2)) ((2 2) (1 0)))
  (pen-non-orig cookie-0)
  (uniq-gen answer)
  (operation generalization weakened ((2 0) (0 0)))
  (traces
    ((recv cookie) (send (enc "request" cookie cookie-0))
      (recv (enc "response" answer cookie cookie-0)))
    ((recv answer) (send answer))
    ((send cookie-0) (recv (enc "request" cookie-0 cookie))
      (send (enc "response" answer cookie-0 cookie))))
  (label 44)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0 1) ((answer answer) (tlskey cookie-0) (cookie cookie))))
  (origs))

(comment "Nothing left to do")
