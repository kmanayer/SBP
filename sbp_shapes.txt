(comment "CPSA 3.6.6")
(comment "Extracted shapes")

(herald "Session Binding Protocol (SBP)")

(comment "CPSA 3.6.6")

(comment "All input read from sbp.lsp")

(defprotocol sbp basic
  (defrole client
    (vars (answer cookie tlskey data))
    (trace (recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))))
  (defrole proxy
    (vars (answer cookie tlskey data))
    (trace (send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (pen-non-orig tlskey)
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))))
  (label 0)
  (unrealized (0 2))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (operation encryption-test (displaced 2 0 client 2)
    (enc "request" cookie tlskey) (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey))))
  (label 3)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand client 2 (cookie cookie) (tlskey tlskey))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (pen-non-orig tlskey)
  (operation encryption-test (added-strand client 2)
    (enc "request" cookie tlskey) (1 1))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie) (recv (enc "request" cookie tlskey))
      (send (enc "response2" answer cookie tlskey)))
    ((recv cookie) (send (enc "request" cookie tlskey))))
  (label 4)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie cookie-0 tlskey-0 data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 3 (answer tlskey) (cookie cookie-0)
    (tlskey tlskey-0))
  (precedes ((1 2) (0 2)))
  (pen-non-orig tlskey)
  (operation generalization deleted (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey)))
    ((send cookie-0) (recv (enc "request" cookie-0 tlskey-0))
      (send (enc "response2" tlskey cookie-0 tlskey-0))))
  (label 11)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(defskeleton sbp
  (vars (tlskey answer cookie data))
  (defstrand client 3 (answer answer) (cookie cookie) (tlskey tlskey))
  (defstrand proxy 1 (cookie tlskey))
  (precedes ((1 0) (0 2)))
  (pen-non-orig tlskey)
  (operation generalization deleted (1 0))
  (traces
    ((recv cookie) (send (enc "request" cookie tlskey))
      (recv (enc "response2" answer cookie tlskey))) ((send tlskey)))
  (label 12)
  (parent 0)
  (unrealized)
  (shape)
  (maps ((0) ((tlskey tlskey) (answer answer) (cookie cookie))))
  (origs))

(comment "Nothing left to do")
